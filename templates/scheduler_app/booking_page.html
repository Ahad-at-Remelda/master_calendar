{% extends "scheduler_app/base_public.html" %}

{% block title %}Select a Date & Time{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center py-5" style="min-height: 100vh; background: linear-gradient(135deg, #f5f7fa, #c3cfe2);">
    <div class="auth-card w-100" style="max-width: 960px;">
        <div class="row g-0">
            <!-- Left Panel: Information -->
            <div class="col-lg-4 border-end p-4">
                <p class="text-muted small">{{ owner.username }}</p>
                <h2 class="h4 fw-bold">Book a Meeting</h2>
                <hr>
                <p><i class="bi bi-clock me-2 text-primary"></i> 30 min Meeting</p>
                <p><i class="bi bi-globe me-2 text-primary"></i> Timezone: UTC</p>
            </div>

            <!-- Right Panel: Date & Time Selection -->
            <div class="col-lg-8 d-flex flex-column flex-md-row">
                <!-- Calendar Date Picker -->
                <div class="p-4" style="flex: 1.2;">
                    <h3 class="h5 mb-3 text-center fw-semibold">Select a Date</h3>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button class="btn btn-sm btn-light rounded-circle shadow-sm" disabled><i class="bi bi-chevron-left"></i></button>
                        <strong>{{ availability.keys.0|date:"F Y" }}</strong>
                        <button class="btn btn-sm btn-light rounded-circle shadow-sm" disabled><i class="bi bi-chevron-right"></i></button>
                    </div>
                    <div class="d-grid gap-1" style="grid-template-columns: repeat(7, 1fr);">
                        <div class="text-center text-muted small fw-bold">MON</div>
                        <div class="text-center text-muted small fw-bold">TUE</div>
                        <div class="text-center text-muted small fw-bold">WED</div>
                        <div class="text-center text-muted small fw-bold">THU</div>
                        <div class="text-center text-muted small fw-bold">FRI</div>
                        <div class="text-center text-muted small fw-bold">SAT</div>
                        <div class="text-center text-muted small fw-bold">SUN</div>

                        {% for date, slots in availability.items %}
                            <button class="btn date-selector {% if slots %}btn-custom text-white{% else %}btn-outline-secondary disabled{% endif %}" 
                                    data-date-iso="{{ date|date:'Y-m-d' }}">
                                {{ date|date:"j" }}
                            </button>
                        {% endfor %}
                    </div>
                </div>

                <!-- Time Slot Picker -->
                <div class="p-4 border-start" id="time-slot-container" style="flex: 1; overflow-y: auto; max-height: 400px;">
                    <h4 id="time-slot-header" class="h6 fw-bold">Select a Time</h4>
                    {% for date, slots in availability.items %}
                        <div class="time-slots-for-date d-none" id="slots-for-{{ date|date:'Y-m-d' }}">
                            {% for slot in slots %}
                                <a href="{% url 'confirm_booking' sharing_uuid=sharing_uuid datetime_iso=slot.isoformat %}" 
                                   class="btn btn-light border w-100 mb-2 rounded-3 shadow-sm">
                                    {{ slot|date:"h:i A" }}
                                </a>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .auth-card {
        background: #fff;
        border-radius: 1.5rem;
        padding: 0;
        box-shadow: 0 12px 30px rgba(0,0,0,0.1);
        animation: fadeIn 0.6s ease-in-out;
    }
    .btn-custom {
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 12px;
        padding: 0.6rem 0.8rem;
        font-weight: 600;
        border: none;
    }
    .btn-custom:hover {
        background: linear-gradient(90deg, #5a67d8, #6a3a8a);
        transform: translateY(-2px);
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dateSelectors = document.querySelectorAll('.date-selector');
    const timeSlotHeader = document.getElementById('time-slot-header');

    dateSelectors.forEach(button => {
        button.addEventListener('click', function() {
            const selectedDateISO = this.dataset.dateIso;
            const selectedDate = new Date(selectedDateISO + 'T00:00:00Z');
            
            timeSlotHeader.textContent = selectedDate.toLocaleDateString('en-US', {
                weekday: 'long', month: 'long', day: 'numeric', timeZone: 'UTC'
            });

            document.querySelectorAll('.time-slots-for-date').forEach(div => div.classList.add('d-none'));
            const targetSlotList = document.getElementById(`slots-for-${selectedDateISO}`);
            if (targetSlotList) targetSlotList.classList.remove('d-none');
        });
    });

    const firstAvailableDate = document.querySelector('.date-selector.btn-custom');
    if (firstAvailableDate) firstAvailableDate.click();
});
</script>
{% endblock %}
